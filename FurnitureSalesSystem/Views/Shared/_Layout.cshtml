@{
    Layout = null;
    var controller = ViewContext.RouteData.Values["controller"]?.ToString();
    var action = ViewContext.RouteData.Values["action"]?.ToString();
    var isProductSectionActive = controller == "Products" || controller == "Categories";
    var isOrderSectionActive = controller == "Orders";
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - AmLive</title>

    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">


    <style>
        :root {
            --primary-color: #6D4C41;
            --secondary-color: #8D6E63;
            --accent-color: #A1887F;
            --light-color: #D7CCC8;
            --dark-color: #3E2723;
        }

        .sidebar {
            transition: all 0.3s ease;
            z-index: 40;
        }

        @@media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 50;
                height: 100vh;
                width: 16rem;
            }

                .sidebar.active {
                    transform: translateX(0);
                }
        }

        .sidebar.collapsed {
            width: 4rem;
        }

            .sidebar.collapsed .sidebar-text {
                display: none;
            }

        .nav-link,
        .dropdown-link {
            display: flex;
            align-items: center;
            padding: 0.625rem 1rem;
            border-radius: 0.375rem;
            color: white;
            transition: all 0.3s ease;
        }

            .nav-link:hover,
            .nav-link.active,
            .dropdown-link:hover,
            .dropdown-link.active {
                color: #ff6567;
                background-color: transparent;
            }

        #quill-container {
            height: 250px;
            background-color: white;
        }

        .ql-toolbar {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }

        .ql-container {
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            min-height: 250px;
        }

        li.active > a {
            color: white !important; /* chữ trắng */
        }

        [x-cloak] {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div class="sidebar bg-[var(--dark-color)] text-white w-64 space-y-6 py-7 px-2 transition-all duration-300"
             id="sidebar">
            <div class="flex items-center space-x-2 px-4">
                <i class="fas fa-couch text-2xl text-[var(--light-color)]"></i>
                <span class="sidebar-text text-xl font-bold">AmLive</span>
            </div>
            <nav x-data="{
        openProduct: false,
        openOrder: false
    }"
                 x-init=" setTimeout(()=> {
        openProduct = @isProductSectionActive.ToString().ToLower();
        openOrder = @isOrderSectionActive.ToString().ToLower();
    }, 50)">

                @if (User.IsInRole("Giám đốc"))
                {
                    <a asp-area="Admin" asp-controller="Dashboard" asp-action="Index"
                       class="nav-link @(controller == "Report" ? "active" : "")">
                        <i class="fas fa-tachometer-alt mr-3"></i> <span class="sidebar-text">Thống kê</span>
                    </a>
                }

                @if (User.IsInRole("Giám đốc") || User.IsInRole("Nhân viên kho") || User.IsInRole("Nhân viên bán hàng"))
                {
                    <!-- Dropdown Sản phẩm -->
                    <div x-data="{ openProduct: @(isProductSectionActive.ToString().ToLower()) }">
                        <button @@click="openProduct = !openProduct"
                                class="nav-link w-full flex justify-between items-center @(isProductSectionActive ? "active" : "")">
                            <span><i class="fas fa-boxes mr-2"></i> <span class="sidebar-text">Sản phẩm</span></span>
                            <i class="fas fa-chevron-down" :class="{ 'rotate-180': openProduct }"></i>
                        </button>
                        <div x-show="openProduct" x-cloak
                             x-transition:enter="transition-all duration-1000 ease-in-out"
                             x-transition:enter-start="opacity-0 max-h-0"
                             x-transition:enter-end="opacity-100 max-h-60"
                             x-transition:leave="transition-all duration-500 ease-in-out"
                             x-transition:leave-start="opacity-100 max-h-60"
                             x-transition:leave-end="opacity-0 max-h-0"
                             class="overflow-hidden bg-[var(--dark-color)] text-white rounded mt-2 space-y-1 ml-4 mr-4 px-2 py-2">
                            <a asp-area="" asp-controller="Products" asp-action="Index"
                               class="dropdown-link @(controller == "Products" && action == "Index" ? "active" : "")">
                                Danh sách sản phẩm
                            </a>
                            <a asp-area="" asp-controller="Products" asp-action="Overview"
                               class="dropdown-link @(controller == "Products" && action == "Overview" ? "active" : "")">
                                Danh mục sản phẩm
                            </a>
                            @if (User.IsInRole("Nhân viên kho"))
                            {
                                <a asp-area="" asp-controller="Products" asp-action="Create"
                                class="dropdown-link @(controller == "Products" && action == "Create" ? "active" : "")">
                                    Thêm sản phẩm
                                </a>
                            }
                        </div>
                    </div>
                }

                @if (User.IsInRole("Giám đốc") || User.IsInRole("Nhân viên bán hàng"))
                {
                    <!-- Dropdown Đơn hàng -->
                    <div x-data="{ openOrder: @(isOrderSectionActive.ToString().ToLower()) }">
                        <button @@click="openOrder = !openOrder"
                                class="nav-link w-full flex justify-between items-center @(isOrderSectionActive ? "active" : "")">
                            <span><i class="fas fa-file-invoice-dollar mr-2"></i> <span class="sidebar-text">Đơn hàng</span></span>
                            <i class="fas fa-chevron-down" :class="{ 'rotate-180': openOrder }"></i>
                        </button>
                        <div x-show="openOrder" x-cloak
                             x-transition:enter="transition-all duration-1000 ease-in-out"
                             x-transition:enter-start="opacity-0 max-h-0"
                             x-transition:enter-end="opacity-100 max-h-60"
                             x-transition:leave="transition-all duration-500 ease-in-out"
                             x-transition:leave-start="opacity-100 max-h-60"
                             x-transition:leave-end="opacity-0 max-h-0"
                             class="overflow-hidden bg-[var(--dark-color)] text-white rounded mt-2 space-y-1 ml-4 mr-4 px-2 py-2">
                            <a asp-area="" asp-controller="Orders" asp-action="Index"
                               class="dropdown-link @(controller == "Orders" && action == "Index" ? "active" : "")">
                                Danh sách đơn hàng
                            </a>
                            @if (User.IsInRole("Nhân viên bán hàng"))
                            {
                                <a asp-area="" asp-controller="Orders" asp-action="Create"
                                class="dropdown-link @(controller == "Orders" && action == "Create" ? "active" : "")">
                                    Tạo đơn hàng mới
                                </a>
                            }
                        </div>
                    </div>
                }

                @if (User.IsInRole("Giám đốc") || User.IsInRole("Nhân viên bán hàng"))
                {
                    <a asp-area="" asp-controller="Customers" asp-action="Index"
                       class="nav-link @(controller == "Customer" ? "active" : "")">
                        <i class="fas fa-users mr-2"></i> <span class="sidebar-text">Khách hàng</span>
                    </a>
                }

                @if (User.IsInRole("Giám đốc"))
                {
                    <a asp-area="Admin" asp-controller="Users" asp-action="Index"
                       class="nav-link @(controller == "Users" ? "active" : "")">
                        <i class="fas fa-user-cog mr-2"></i> <span class="sidebar-text">Quản lý người dùng</span>
                    </a>
                }
            </nav>
        </div>

        <!-- Main content -->
        <div class="flex-1 overflow-auto">
            <!-- Header -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between px-6 py-4">
                    <button id="sidebarToggle" class="text-gray-600">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <input type="text" placeholder="Tìm kiếm..." class="border rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)]">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <button class="text-gray-600">
                                <i class="fas fa-bell text-xl"></i>
                            </button>
                        </div>
                        <div class="flex items-center">
                            <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="User" class="w-8 h-8 rounded-full" />
                            <span class="ml-2 font-medium">Admin</span>
                        </div>
                        <form asp-area="" asp-controller="Account" asp-action="Logout" method="post" class="ml-4">
                            <button type="submit" class="text-sm text-red-600 hover:underline font-medium">
                                <i class="fas fa-sign-out-alt mr-1"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <main class="p-6">
                @RenderBody()
            </main>
        </div>
    </div>

    <script>
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('sidebarToggle');

        toggleBtn?.addEventListener('click', () => {
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        });
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
